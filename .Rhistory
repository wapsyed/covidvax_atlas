) %>%
column_to_rownames("Subject_Timepoint")
write.csv(gse199750_metadata, file =here("raw_data", "metadata_gse199750.csv"))
raw_RNASeq_counts = readRDS(here("raw_data", "raw_RNASeq_counts.RDS"))
raw_RNASeq_counts = readRDS(here("raw_data", "raw_RNASeq_counts.RDS"))
raw_RNASeq_counts
# The counts table provided by the study("https://bitbucket.org/lynnlab/covirs/src/master/raw_RNASeq_counts.RDS") is named with Subject ID + Timepoint and not with the GSM code. Therefore, we will need to process the metadata table. Additionally, it lacks the age column. These data can be manipulated in Excel.
############# Gene annotation -----
library("biomaRt")
mart <- useDataset("hsapiens_gene_ensembl", mart)
mart <- useMart("ensembl")
mart <- useDataset("hsapiens_gene_ensembl", mart)
raw_RNASeq_counts
rownames_to_column("ensembl_ids")
ensembl_ids <- raw_RNASeq_counts %>%
gene_info <- getBM(attributes = c("entrezgene_id", "hgnc_symbol"),
values = ensembl_ids,
gene_info <- getBM(attributes = c("entrezgene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values = ensembl_ids,
mart = mart)
ensembl_ids <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_ids")
gene_info <- getBM(attributes = c("entrezgene_id", "hgnc_symbol"),
gene_info <- getBM(attributes = c("entrezgene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values = ensembl_ids,
mart = mart)
distinct() %>%
raw_RNASeq_counts_ann <- raw_RNASeq_counts %>%
inner_join(gene_info, by = "ensembl_ids") %>%
drop_na(hgnc_symbol) %>%
distinct() %>%
mutate(hgnc_symbol = coalesce(hgnc_symbol, Geneid)) %>%
distinct(hgnc_symbol, .keep_all = TRUE)
rlang::last_trace()
raw_RNASeq_counts %>%
inner_join(gene_info, by = "ensembl_ids")
gene_info
rownames_to_column("ensembl_gene_id")
ensembl_ids <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id")
ensembl_ids
select(ensembl_gene_id)
nsembl_ids <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
select(ensembl_gene_id)
ensembl_ids
ensembl_ids <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
select(ensembl_gene_id)
ensembl_ids
gene_info <- getBM(attributes = c("entrezgene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values = ensembl_ids,
mart = mart)
gene_info
ensembl_ids <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
select(ensembl_gene_id_rows = ensembl_gene_id) %>%
rownames_to_column("ensembl_gene_id_rows")
ensembl_ids <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
rename(ensembl_gene_id_rows = ensembl_gene_id) %>%
rownames_to_column("ensembl_gene_id_rows")
raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id")
raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
select(ensembl_gene_id) %>%
distinct()
raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
select(ensembl_gene_id) %>%
distinct() %>%
rename(ensembl_gene_id_rows = ensembl_gene_id) %>%
rownames_to_column("ensembl_gene_id_rows")
raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
select(ensembl_gene_id) %>%
rename(ensembl_gene_id_rows = ensembl_gene_id) %>%
distinct() %>%
rownames_to_column("ensembl_gene_id_rows")
ensembl_ids <- raw_RNASeq_counts[[1]]
ensembl_ids
raw_RNASeq_counts
raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id")
raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
select(ensembl_gene_id) %>%
mutate(ensembl_gene_id_rows = ensembl_gene_id)
raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
select(ensembl_gene_id) %>%
mutate(ensembl_gene_id_rows = ensembl_gene_id) %>%
distinct()
raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
select(ensembl_gene_id) %>%
mutate(ensembl_gene_id_rows = ensembl_gene_id) %>%
distinct() %>%
rownames_to_column("ensembl_gene_id_rows")
raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
select(ensembl_gene_id) %>%
mutate(ensembl_gene_id_rows = ensembl_gene_id) %>%
distinct()
column_to_rownames("ensembl_gene_id_rows")
ensembl_ids <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
select(ensembl_gene_id) %>%
mutate(ensembl_gene_id_rows = ensembl_gene_id) %>%
distinct() %>%
column_to_rownames("ensembl_gene_id_rows")
gene_info <- getBM(attributes = c("entrezgene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values = ensembl_ids,
mart = mart)
gene_info
gene_info =  gene_info %>% cbind(ensembl_ids)
gene_info
gene_info <- getBM(attributes = c("entrezgene_id", "hgnc_symbol", "ensembl_gene_id"),
filters = "ensembl_gene_id",
values = ensembl_ids,
mart = mart)
gene_info
mart
mart
gene_info <- getBM(attributes = c("entrezgene_id", "hgnc_symbol", "ensembl_gene_id"),
mart = mart)
?getBM
listAttributes()
listAttributes(mart)
gene_info <- getBM(attributes = c("entrezgene_id", "hgnc_symbol", "ensembl_gene_id"),
filters = "ensembl_gene_id",
values = ensembl_ids,
mart = mart)
ensembl = useEnsembl(biomart="ensembl", dataset="hsapiens_gene_ensembl")
library(biomaRt)
ensembl = useEnsembl(biomart="ensembl", dataset="hsapiens_gene_ensembl")
# The counts table provided by the study("https://bitbucket.org/lynnlab/covirs/src/master/raw_RNASeq_counts.RDS") is named with Subject ID + Timepoint and not with the GSM code. Therefore, we will need to process the metadata table. Additionally, it lacks the age column. These data can be manipulated in Excel.
############# Gene annotation -----
library("biomaRt")
mart <- useDataset("hsapiens_gene_ensembl", mart)
library(tidyverse)
ensembl_ids
gene_info <- getBM(attributes = c("entrezgene_id", "hgnc_symbol", "ensembl_gene_id"),
gene_info <- getBM(attributes = c("entrezgene_id", "hgnc_symbol", "ensembl_gene_id"),
mart = mart)
gene_info
select(ensembl_gene_id, hgnc_symbol)
gene_info <- getBM(attributes = c("entrezgene_id", "hgnc_symbol", "ensembl_gene_id"),
mart = mart) %>%
select(ensembl_gene_id, hgnc_symbol)
gene_info
distinct()
gene_info <- getBM(attributes = c("entrezgene_id", "hgnc_symbol", "ensembl_gene_id"),
mart = mart) %>%
select(ensembl_gene_id, hgnc_symbol) %>%
distinct()
raw_RNASeq_counts
inner_join(gene_info, by = "ensembl_gene_id") %>%
raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
inner_join(gene_info, by = "ensembl_gene_id") %>%
drop_na(hgnc_symbol) %>%
distinct()
raw_RNASeq_counts
raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id")
raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
inner_join(gene_info, by = "ensembl_gene_id")
raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
inner_join(gene_info, by = "ensembl_gene_id") %>%
drop_na(hgnc_symbol)
raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
inner_join(gene_info, by = "ensembl_gene_id") %>%
drop_na(hgnc_symbol) %>%
distinct()
raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
inner_join(gene_info, by = "ensembl_gene_id") %>%
drop_na(hgnc_symbol) %>%
distinct() %>%
select(hgnc_symbol, ensembl_gene_id, everything())
gene_info <- getBM(attributes = c("entrezgene_id", "hgnc_symbol", "ensembl_gene_id"),
mart = mart,
values = ensembl_ids) %>%
select(ensembl_gene_id, hgnc_symbol) %>%
distinct()
gene_info
view(gene_info)
tibble(gene_info)
tibble(gene_info) %>% print(n = 50)
gene_info %>% filter(hgnc_symbol != "")
raw_RNASeq_counts_ann <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
inner_join(gene_info, by = "ensembl_gene_id") %>%
filter(hgnc_symbol != "") %>%
distinct() %>%
select(hgnc_symbol, ensembl_gene_id, everything())
raw_RNASeq_counts_ann <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
inner_join(gene_info, by = "ensembl_gene_id") %>%
filter(hgnc_symbol != "") %>%
distinct() %>%
select(-ensembl_gene_id, hgnc_symbol, everything())
raw_RNASeq_counts_ann <- raw_RNASeq_counts %>%
raw_RNASeq_counts_ann <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
inner_join(gene_info, by = "ensembl_gene_id") %>%
filter(hgnc_symbol != "") %>%
distinct() %>%
select(-ensembl_gene_id, hgnc_symbol, everything())
library(tidymodels)
raw_RNASeq_counts_ann <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
inner_join(gene_info, by = "ensembl_gene_id") %>%
filter(hgnc_symbol != "") %>%
distinct() %>%
select(-ensembl_gene_id, hgnc_symbol, everything())
raw_RNASeq_counts_ann
raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
inner_join(gene_info, by = "ensembl_gene_id") %>%
filter(hgnc_symbol != "") %>%
distinct() %>%
select(-ensembl_gene_id) %>%
select(hgnc_symbol, everything())
raw_RNASeq_counts_ann %>%
column_to_rownames("hgnc_symbol") %>%
.[, sort(colnames(.))]
raw_RNASeq_counts_ann %>%
distinct() %>%
column_to_rownames("hgnc_symbol")
raw_RNASeq_counts_ann %>%
distinct()
raw_RNASeq_counts_ann <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
inner_join(gene_info, by = "ensembl_gene_id") %>%
filter(hgnc_symbol != "") %>%
distinct() %>%
select(-ensembl_gene_id) %>%
select(hgnc_symbol, everything())
raw_RNASeq_counts_ann %>%
distinct()
raw_RNASeq_counts_ann %>%
distinct() %>%
column_to_rownames("hgnc_symbol")
raw_RNASeq_counts_ann %>%
distinct()
raw_RNASeq_counts_ann %>%
distinct() %>%
get_dupes()
library(tidyverse)
raw_RNASeq_counts_ann %>%
distinct() %>%
get_dupes()
library(janitor)
raw_RNASeq_counts_ann %>%
distinct() %>%
get_dupes()
raw_RNASeq_counts_ann <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
inner_join(gene_info, by = "ensembl_gene_id") %>%
filter(hgnc_symbol != "") %>%
distinct() %>%
select(-ensembl_gene_id) %>%
select(genes = hgnc_symbol, everything())
raw_RNASeq_counts_ann %>%
distinct()
raw_RNASeq_counts_ann %>%
distinct() %>%
column_to_rownames("genes")
raw_RNASeq_counts_ann %>%
distinct()
raw_RNASeq_counts_ann %>%
distinct() %>%
.[, sort(colnames(.))]
raw_RNASeq_counts_ann <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
inner_join(gene_info, by = "ensembl_gene_id") %>%
filter(hgnc_symbol != "") %>%
distinct() %>%
select(-ensembl_gene_id) %>%
.[, sort(colnames(.))] %>%
select(genes = hgnc_symbol, everything())
raw_RNASeq_counts_ann
raw_RNASeq_counts_ann <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
inner_join(gene_info, by = "ensembl_gene_id") %>%
filter(hgnc_symbol != "") %>%
distinct() %>%
select(-ensembl_gene_id) %>%
select(sort(names(.))) %>%
select(genes = hgnc_symbol, everything())
raw_RNASeq_counts_ann
arrange(genes)
raw_RNASeq_counts_ann <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
inner_join(gene_info, by = "ensembl_gene_id") %>%
filter(hgnc_symbol != "") %>%
distinct() %>%
select(-ensembl_gene_id) %>%
select(sort(names(.))) %>%
select(genes = hgnc_symbol, everything()) %>%
arrange(genes)
raw_RNASeq_counts_ann
raw_RNASeq_counts_ann %>%
column_to_rownames()
raw_RNASeq_counts_ann %>%
column_to_rownames("genes")
raw_RNASeq_counts_ann
raw_RNASeq_counts_ann %>%
column_to_rownames(var = "genes")
raw_RNASeq_counts_ann %>%
get_dupes(genes)
raw_RNASeq_counts_ann <- raw_RNASeq_counts %>%
rownames_to_column("ensembl_gene_id") %>%
inner_join(gene_info, by = "ensembl_gene_id") %>%
filter(hgnc_symbol != "") %>%
distinct() %>%
select(sort(names(.))) %>%
select(genes = hgnc_symbol, ensembl_gene_id, everything()) %>%
arrange(genes)
raw_RNASeq_counts_ann
raw_RNASeq_counts_ann %>%
get_dupes(genes, ensembl_gene_id)
raw_RNASeq_counts_ann %>%
get_dupes(genes)
raw_RNASeq_counts_ann %>%
get_dupes(genes) %>%
raw_RNASeq_counts_ann %>%
get_dupes(genes)
raw_RNASeq_counts_ann %>%
get_dupes(genes)
raw_RNASeq_counts_ann %>%
get_dupes(genes) %>%
group_by(genes)
raw_RNASeq_counts_ann %>%
get_dupes(genes) %>%
group_by(genes) %>%
arrange(ensembl_gene_id)
raw_RNASeq_counts_ann %>%
get_dupes(genes) %>%
group_by(genes) %>%
arrange(ensembl_gene_id) %>%
slice(n = 1)
raw_RNASeq_counts_ann %>%
get_dupes(genes) %>%
group_by(genes) %>%
arrange(ensembl_gene_id) %>%
slice(1)
dupes
dupes = raw_RNASeq_counts_ann %>%
get_dupes(genes) %>%
group_by(genes) %>%
arrange(ensembl_gene_id) %>%
slice(1)
dupes
dupes = raw_RNASeq_counts_ann %>%
get_dupes(genes) %>%
group_by(genes) %>%
arrange(ensembl_gene_id) %>%
slice(1) %>%
ungroup()
dupes
dupes = raw_RNASeq_counts_ann %>%
get_dupes(genes) %>%
group_by(genes) %>%
arrange(ensembl_gene_id) %>%
slice(2) %>%
ungroup()
dupes
not_interes = raw_RNASeq_counts_ann %>%
get_dupes(genes) %>%
group_by(genes) %>%
arrange(ensembl_gene_id) %>%
slice(2) %>%
ungroup() %>%
select(ensembl_gene_id)
not_interes
raw_RNASeq_counts_ann %>%
anti_join(not_interes, by = "ensembl_gene_id")
raw_RNASeq_counts_ann %>%
anti_join(not_interes, by = "ensembl_gene_id") %>%
select(-ensembl_gene_id) %>%
column_to_rownames("genes")
gse199750_counts_ready = raw_RNASeq_counts_ann %>%
anti_join(not_interes, by = "ensembl_gene_id") %>%
select(-ensembl_gene_id) %>%
column_to_rownames("genes")
citation("shiny")
citation("flexdashboard")
pvca_df_plot
normalizedcounts_pca_plot
normalizedcounts_pca_plot %>% ggplotly()
library(plotly)
normalizedcounts_pca_plot %>% ggplotly()
PC1_genes_counts
####### INPUT
PC1 = var$cos2 %>%
as.data.frame() %>%
arrange(desc(Dim.1)) %>%
filter(Dim.1 >= 0.5) %>%
#slice_head(n=20) %>%
rownames_to_column("genes") %>%
distinct() %>%
select(genes, cos2 = Dim.1) %>%
mutate(dimension = "PC1")
PC2 = var$cos2 %>%
as.data.frame() %>%
filter(Dim.2 >= 0.5) %>%
#slice_head(n=20) %>%
rownames_to_column("genes") %>%
distinct() %>%
select(genes, cos2 = Dim.2) %>%
mutate(dimension = "PC2")
PC1_2 = bind_rows(PC1, PC2)
PC1_2 %>%
select(genes) %>% distinct()
age_stats
p
select(doses_abrev, participants, vac_infection) %>%
participants = Studies_Participants %>%
participants = Studies_Participants %>%
select(doses_abrev, participants, vac_infection) %>%
distinct() %>%
group_by(dose) %>%
summarise(n_total_participants = sum(participants)) %>%
inner_join(Studies_Participants, by = "doses_abrev") %>%
rename(condition = doses_abrev) %>%
select(condition, n_total_participants, vac_infection) %>%
distinct()
participants
p = participants %>%
filter(!is.na(condition)) %>%
ggplot(aes(x = fct_reorder(condition, desc(n_total_participants)),
weight = n_total_participants)) +
geom_bar(fill = "#5e60ce") +
theme_minimal() +
scale_fill_manual(values = "#5e60ce") +
theme(legend.position = "right",
axis.text.x = element_text(size = 16, color = "black", angle = 45, vjust = 1, hjust = 1),
axis.text.y = element_blank(),
panel.grid.minor = element_blank(),
panel.grid.major = element_blank(),
panel.grid.major.x = element_line(color = "gray70",
size = 0.1,
linetype = 1)) +
geom_text(aes(label = n_total_participants, y = n_total_participants),
position = position_dodge(width = 0),
vjust = -0.2,
hjust = 0.5,
size = 5,
angle = 0) +
ylim(0, 70)+
ggtitle("Participants by condition") +
labs(x = "Conditions",
y = "Participants")
p
ann_vaccines_samples_participants
sex = ann_vaccines_samples_participants %>%
select(sex, participant_id, gse_id) %>%
distinct()
sex
sex = ann_vaccines_samples_participants %>%
select(sex, participant_id, gse_id) %>%
distinct() %>%
group_by(gse_id) %>%
summarize(n_sex = n())
sex
sex = ann_vaccines_samples_participants %>%
select(sex, participant_id, gse_id) %>%
distinct() %>%
group_by(gse_id, sex) %>%
summarize(n_sex = n())
sex
ann_vaccines_samples_participants %>%
select(sex, participant_id, gse_id) %>%
distinct() %>%
group_by(gse_id, sex) %>%
summarize(n_sex = n(),
total = sum(n_sex))
ann_vaccines_samples_participants %>%
select(sex, participant_id, gse_id) %>%
distinct() %>%
group_by(gse_id, sex) %>%
summarize(n_sex = n()) %>%
ungroup() %>%
group(gse_id) %>%
summarize(total = sum(n_sex))
ann_vaccines_samples_participants %>%
select(sex, participant_id, gse_id) %>%
distinct() %>%
group_by(gse_id, sex) %>%
summarize(n_sex = n()) %>%
ungroup() %>%
group_by(gse_id) %>%
summarize(total = sum(n_sex))
ann_vaccines_samples_participants %>%
select(sex, participant_id, gse_id) %>%
distinct() %>%
group_by(gse_id, sex) %>%
summarize(n_sex = n()) %>%
ungroup() %>%
group_by(gse_id) %>%
summarize(total = sum(n_sex), .drop = F)
