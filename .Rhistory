show_heatmap_legend = TRUE,
heatmap_legend_param = list(direction = "horizontal"),
col = col_fun, #color
show_column_names = TRUE,
column_title = fileimageheatmap_grouped,
column_title_gp = gpar(fontsize = 10, fontface = "bold"),
column_names_rot = 45,
column_names_gp = column_names_gp,
rect_gp = rect_gp,
na_col = "white",
cluster_rows = TRUE,
row_names_gp = row_names_gp,
row_dend_width = unit(0, "cm"),
row_split = 2,
column_split = 4,
row_gap = unit(2, "mm"),
cluster_columns = TRUE,
column_gap = unit(2, "mm"),
show_column_dend = F,
show_row_dend = F,
row_dend_side = "left",
column_dend_side = "top",
clustering_distance_rows = "euclidean",
border = TRUE,
width = width,
height = height)
heatmap_plot = draw(heatmap_plot,
annotation_legend_side = "left",
heatmap_legend_side = "left")
dev.off()
################# Immune
#Heatmap annotation
ha = HeatmapAnnotation(df = ann_cols_heatmap,
col = ann_vaxsig_colors,
annotation_name_side = "right")
row_ha = HeatmapAnnotation(df = ann_rows_immune,
col = col_process_immune,
which= "row",
show_annotation_name = F,
show_legend = F,
width = unit(0.1, "cm"))
# Values colors
col_fun <- colorRamp2(c(-2, 0, 2), c("#9bc1bc", "white", "#ed6a5a"))
file = filename_2
mat = matrix_data
width_image = 30
height_image = 10
width = unit(15, "cm")
height = unit(5, "cm")
column_names_gp = gpar(fontsize = 10)
row_names_gp = gpar(fontsize = 10)
rect_gp = gpar(col = "gray80", lwd = 0.5)
fileimageheatmap_grouped = paste0(file, sep ="_", "Complexheatmap.png")
png(file = fileimageheatmap_grouped,
width = width_image,
height = height_image,
units="cm",
res=900)
heatmap_plot = Heatmap(mat,
top_annotation = ha,
left_annotation = row_ha,
show_row_names = TRUE,
row_names_side = "right",
show_heatmap_legend = TRUE,
heatmap_legend_param = list(direction = "horizontal"),
col = col_fun, #color
show_column_names = TRUE,
column_title = fileimageheatmap_grouped,
column_title_gp = gpar(fontsize = 10, fontface = "bold"),
column_names_rot = 45,
column_names_gp = column_names_gp,
rect_gp = rect_gp,
na_col = "white",
cluster_rows = TRUE,
row_names_gp = row_names_gp,
row_dend_width = unit(0, "cm"),
row_split = 2,
column_split = 4,
row_gap = unit(2, "mm"),
cluster_columns = TRUE,
column_gap = unit(2, "mm"),
show_column_dend = F,
show_row_dend = F,
row_dend_side = "left",
column_dend_side = "top",
clustering_distance_rows = "euclidean",
border = TRUE,
width = width,
height = height)
heatmap_plot = draw(heatmap_plot,
annotation_legend_side = "left",
heatmap_legend_side = "left")
dev.off()
################# Immune
#Heatmap annotation
ha = HeatmapAnnotation(df = ann_cols_heatmap,
col = ann_vaxsig_colors,
annotation_name_side = "right")
row_ha = HeatmapAnnotation(df = ann_rows_immune,
col = col_process_immune,
which= "row",
show_annotation_name = F,
show_legend = F,
width = unit(0.1, "mm"))
# Values colors
col_fun <- colorRamp2(c(-2, 0, 2), c("#9bc1bc", "white", "#ed6a5a"))
file = filename_2
mat = matrix_data
width_image = 30
height_image = 10
width = unit(15, "cm")
height = unit(5, "cm")
column_names_gp = gpar(fontsize = 10)
row_names_gp = gpar(fontsize = 10)
rect_gp = gpar(col = "gray80", lwd = 0.5)
fileimageheatmap_grouped = paste0(file, sep ="_", "Complexheatmap.png")
png(file = fileimageheatmap_grouped,
width = width_image,
height = height_image,
units="cm",
res=900)
heatmap_plot = Heatmap(mat,
top_annotation = ha,
left_annotation = row_ha,
show_row_names = TRUE,
row_names_side = "right",
show_heatmap_legend = TRUE,
heatmap_legend_param = list(direction = "horizontal"),
col = col_fun, #color
show_column_names = TRUE,
column_title = fileimageheatmap_grouped,
column_title_gp = gpar(fontsize = 10, fontface = "bold"),
column_names_rot = 45,
column_names_gp = column_names_gp,
rect_gp = rect_gp,
na_col = "white",
cluster_rows = TRUE,
row_names_gp = row_names_gp,
row_dend_width = unit(0, "cm"),
row_split = 2,
column_split = 4,
row_gap = unit(2, "mm"),
cluster_columns = TRUE,
column_gap = unit(2, "mm"),
show_column_dend = F,
show_row_dend = F,
row_dend_side = "left",
column_dend_side = "top",
clustering_distance_rows = "euclidean",
border = TRUE,
width = width,
height = height)
heatmap_plot = draw(heatmap_plot,
annotation_legend_side = "left",
heatmap_legend_side = "left")
dev.off()
################# Immune
#Heatmap annotation
ha = HeatmapAnnotation(df = ann_cols_heatmap,
col = ann_vaxsig_colors,
annotation_name_side = "right")
row_ha = HeatmapAnnotation(df = ann_rows_immune,
col = col_process_immune,
which= "row",
show_annotation_name = F,
show_legend = F,
simple_anno_size = unit(8, "mm"))
# Values colors
col_fun <- colorRamp2(c(-2, 0, 2), c("#9bc1bc", "white", "#ed6a5a"))
file = filename_2
mat = matrix_data
width_image = 30
height_image = 10
width = unit(15, "cm")
height = unit(5, "cm")
column_names_gp = gpar(fontsize = 10)
row_names_gp = gpar(fontsize = 10)
rect_gp = gpar(col = "gray80", lwd = 0.5)
fileimageheatmap_grouped = paste0(file, sep ="_", "Complexheatmap.png")
png(file = fileimageheatmap_grouped,
width = width_image,
height = height_image,
units="cm",
res=900)
heatmap_plot = Heatmap(mat,
top_annotation = ha,
left_annotation = row_ha,
show_row_names = TRUE,
row_names_side = "right",
show_heatmap_legend = TRUE,
heatmap_legend_param = list(direction = "horizontal"),
col = col_fun, #color
show_column_names = TRUE,
column_title = fileimageheatmap_grouped,
column_title_gp = gpar(fontsize = 10, fontface = "bold"),
column_names_rot = 45,
column_names_gp = column_names_gp,
rect_gp = rect_gp,
na_col = "white",
cluster_rows = TRUE,
row_names_gp = row_names_gp,
row_dend_width = unit(0, "cm"),
row_split = 2,
column_split = 4,
row_gap = unit(2, "mm"),
cluster_columns = TRUE,
column_gap = unit(2, "mm"),
show_column_dend = F,
show_row_dend = F,
row_dend_side = "left",
column_dend_side = "top",
clustering_distance_rows = "euclidean",
border = TRUE,
width = width,
height = height)
heatmap_plot = draw(heatmap_plot,
annotation_legend_side = "left",
heatmap_legend_side = "left")
dev.off()
################# Immune
#Heatmap annotation
ha = HeatmapAnnotation(df = ann_cols_heatmap,
col = ann_vaxsig_colors,
annotation_name_side = "right")
row_ha = HeatmapAnnotation(df = ann_rows_immune,
col = col_process_immune,
which= "row",
show_annotation_name = F,
show_legend = F,
simple_anno_size = unit(1, "mm"))
# Values colors
col_fun <- colorRamp2(c(-2, 0, 2), c("#9bc1bc", "white", "#ed6a5a"))
file = filename_2
mat = matrix_data
width_image = 30
height_image = 10
width = unit(15, "cm")
height = unit(5, "cm")
column_names_gp = gpar(fontsize = 10)
row_names_gp = gpar(fontsize = 10)
rect_gp = gpar(col = "gray80", lwd = 0.5)
fileimageheatmap_grouped = paste0(file, sep ="_", "Complexheatmap.png")
png(file = fileimageheatmap_grouped,
width = width_image,
height = height_image,
units="cm",
res=900)
heatmap_plot = Heatmap(mat,
top_annotation = ha,
left_annotation = row_ha,
show_row_names = TRUE,
row_names_side = "right",
show_heatmap_legend = TRUE,
heatmap_legend_param = list(direction = "horizontal"),
col = col_fun, #color
show_column_names = TRUE,
column_title = fileimageheatmap_grouped,
column_title_gp = gpar(fontsize = 10, fontface = "bold"),
column_names_rot = 45,
column_names_gp = column_names_gp,
rect_gp = rect_gp,
na_col = "white",
cluster_rows = TRUE,
row_names_gp = row_names_gp,
row_dend_width = unit(0, "cm"),
row_split = 2,
column_split = 4,
row_gap = unit(2, "mm"),
cluster_columns = TRUE,
column_gap = unit(2, "mm"),
show_column_dend = F,
show_row_dend = F,
row_dend_side = "left",
column_dend_side = "top",
clustering_distance_rows = "euclidean",
border = TRUE,
width = width,
height = height)
heatmap_plot = draw(heatmap_plot,
annotation_legend_side = "left",
heatmap_legend_side = "left")
dev.off()
################# Immune
#Heatmap annotation
ha = HeatmapAnnotation(df = ann_cols_heatmap,
col = ann_vaxsig_colors,
annotation_name_side = "right")
row_ha = HeatmapAnnotation(df = ann_rows_immune,
col = col_process_immune,
which= "row",
show_annotation_name = F,
show_legend = F,
simple_anno_size = unit(2, "mm"))
# Values colors
col_fun <- colorRamp2(c(-2, 0, 2), c("#9bc1bc", "white", "#ed6a5a"))
file = filename_2
mat = matrix_data
width_image = 30
height_image = 10
width = unit(15, "cm")
height = unit(5, "cm")
column_names_gp = gpar(fontsize = 10)
row_names_gp = gpar(fontsize = 10)
rect_gp = gpar(col = "gray80", lwd = 0.5)
fileimageheatmap_grouped = paste0(file, sep ="_", "Complexheatmap.png")
png(file = fileimageheatmap_grouped,
width = width_image,
height = height_image,
units="cm",
res=900)
heatmap_plot = Heatmap(mat,
top_annotation = ha,
left_annotation = row_ha,
show_row_names = TRUE,
row_names_side = "right",
show_heatmap_legend = TRUE,
heatmap_legend_param = list(direction = "horizontal"),
col = col_fun, #color
show_column_names = TRUE,
column_title = fileimageheatmap_grouped,
column_title_gp = gpar(fontsize = 10, fontface = "bold"),
column_names_rot = 45,
column_names_gp = column_names_gp,
rect_gp = rect_gp,
na_col = "white",
cluster_rows = TRUE,
row_names_gp = row_names_gp,
row_dend_width = unit(0, "cm"),
row_split = 2,
column_split = 4,
row_gap = unit(2, "mm"),
cluster_columns = TRUE,
column_gap = unit(2, "mm"),
show_column_dend = F,
show_row_dend = F,
row_dend_side = "left",
column_dend_side = "top",
clustering_distance_rows = "euclidean",
border = TRUE,
width = width,
height = height)
heatmap_plot = draw(heatmap_plot,
annotation_legend_side = "left",
heatmap_legend_side = "left")
dev.off()
library(readr)
vipgenes_tidymodels_type2024_03_29 <- read_csv("Random forest/vipgenes_tidymodels_type2024-03-29.csv")
View(vipgenes_tidymodels_type2024_03_29)
vipgenes_tidymodels_type2024_03_29 <- read_csv("vipgenes_tidymodels_type2024-03-29.csv")
vip_genes = vipgenes_tidymodels_type2024_03_29
ImmuneGO_Annotated_Genes= `ImmuneGO_Annotated_Genes_2024-03-26`
vipgenes_tidymodels_disease_vac2024_04_24 <- read_csv("vipgenes_tidymodels_disease_vac2024-04-24.csv")
vipgenes_tidymodels_type2024_03_29 <- read_csv("vipgenes_tidymodels_type2024-03-29.csv")
vip_genes = vipgenes_tidymodels_type2024_03_29
outcomevar = "_Type_"
rf_genes = vip_genes %>%
clean_names() %>%
select(genes = variable, importance)
ImmuneGO_Genes = all_degs_p_05_vac_infected_19_12_23 %>%
inner_join(rf_genes %>%
select(genes) %>%
distinct() %>%
select(genes),
by = "genes") %>%
distinct()
####### INPUT
data_2 = ImmuneGO_Genes
filename_2 = paste0("RandomForest_ImmuneGO_Genes", outcomevar)
######## Matrix
matrix = data_2 %>%
select(genes, condition, log2fold_change) %>%
pivot_wider(names_from = "condition",
values_from = "log2fold_change",
values_fn = mean) %>%
replace(is.na(.), 0) %>%
arrange(genes) %>%
column_to_rownames(var="genes") %>%
as.matrix()
######## Annotations
ann_vaccines_covid_other_2 = data_2 %>%
select(condition) %>%
inner_join(ann_vaccines, by = "condition") %>%
distinct() %>%
select(condition, disease_vac, type,week)
#Columns
ann_cols_heatmap = matrix %>%
colnames() %>%
data.frame() %>%
filter(. != "genes") %>%
rename(condition = '.') %>%
inner_join(ann_vaccines_covid_other_2, by = "condition") %>%
distinct() %>%
arrange(condition) %>%
column_to_rownames("condition")
matrix_data = matrix %>%
t() %>%
as.data.frame() %>%
rownames_to_column(var= "condition") %>%
inner_join(ann_cols_heatmap %>% rownames_to_column("condition"), by = "condition") %>%
select(!c(disease_vac:week)) %>%
arrange(condition) %>%
column_to_rownames("condition") %>%
t() %>%
as.data.frame() %>%
mutate_if(is.character, as.numeric) %>%
as.matrix()
#Rows Immune ----
ann_rows_immune = matrix_data %>%
as.data.frame() %>%
rownames_to_column("genes") %>%
left_join(ImmuneGO_Annotated_Genes %>% filter(go_term == "Manual"), by = "genes") %>%
select(genes, process) %>%
distinct() %>%
group_by(genes) %>%
arrange(genes, factor(process, levels = c("INNATE IMMUNE SYSTEM", "ADAPTIVE IMMUNE SYSTEM")), .by_group = TRUE) %>%
mutate(i_process = row_number()) %>%
pivot_wider(., names_from = "i_process", values_from = "process") %>%
column_to_rownames("genes") %>%
t() %>%
as.data.frame() %>%
rownames_to_column("index") %>%
mutate(index = as.numeric(index)) %>%
arrange(desc(index)) %>%
column_to_rownames("index") %>%
t() %>%
as.data.frame() %>%
replace(is.na(.), ".") %>%
mutate(`1` = if_else(`1` == ".", "INNATE IMMUNE SYSTEM", `1`))
#Verificar dimensões do dataset
dim(matrix)
dim(matrix_data)
dim(ann_cols_heatmap)
dim(ann_rows_immune)
################# Immune
#Heatmap annotation
ha = HeatmapAnnotation(df = ann_cols_heatmap,
col = ann_vaxsig_colors,
annotation_name_side = "right")
row_ha = HeatmapAnnotation(df = ann_rows_immune,
col = col_process_immune,
which= "row",
show_annotation_name = F,
show_legend = F,
simple_anno_size = unit(2, "mm"))
# Values colors
col_fun <- colorRamp2(c(-2, 0, 2), c("#9bc1bc", "white", "#ed6a5a"))
file = filename_2
mat = matrix_data
width_image = 30
height_image = 10
width = unit(15, "cm")
height = unit(5, "cm")
column_names_gp = gpar(fontsize = 10)
row_names_gp = gpar(fontsize = 10)
rect_gp = gpar(col = "gray80", lwd = 0.5)
fileimageheatmap_grouped = paste0(file, sep ="_", "Complexheatmap.png")
png(file = fileimageheatmap_grouped,
width = width_image,
height = height_image,
units="cm",
res=900)
heatmap_plot = Heatmap(mat,
top_annotation = ha,
left_annotation = row_ha,
show_row_names = TRUE,
row_names_side = "right",
show_heatmap_legend = TRUE,
heatmap_legend_param = list(direction = "horizontal"),
col = col_fun, #color
show_column_names = TRUE,
column_title = fileimageheatmap_grouped,
column_title_gp = gpar(fontsize = 10, fontface = "bold"),
column_names_rot = 45,
column_names_gp = column_names_gp,
rect_gp = rect_gp,
na_col = "white",
cluster_rows = TRUE,
row_names_gp = row_names_gp,
row_dend_width = unit(0, "cm"),
row_split = 2,
column_split = 2,
row_gap = unit(2, "mm"),
cluster_columns = TRUE,
column_gap = unit(2, "mm"),
show_column_dend = F,
show_row_dend = F,
row_dend_side = "left",
column_dend_side = "top",
clustering_distance_rows = "euclidean",
border = TRUE,
width = width,
height = height)
heatmap_plot = draw(heatmap_plot,
annotation_legend_side = "left",
heatmap_legend_side = "left")
dev.off()
final_res_preds %>%
group_by(correct, disease_vac...8) %>%
tabyl(correct, disease_vac...8) %>%
as.data.frame() %>%
summarize()
final_res_preds %>%
group_by(correct, disease_vac...8) %>%
tabyl(correct, disease_vac...8) %>%
as.data.frame()
final_res_preds %>%
group_by(correct, disease_vac...8) %>%
tabyl(correct, disease_vac...8) %>%
as.data.frame() %>%
group_by(correct) %>%
summarize(sensitivity = V/(I + V),
specificity = I/(I + V))
