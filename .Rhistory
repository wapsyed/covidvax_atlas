heatmap_legend_param = list(direction = "vertical"),
col = col_fun, #color
show_column_names = TRUE,
column_title = fileimageheatmap_grouped,
column_title_gp = gpar(fontsize = 10, fontface = "bold"),
column_names_rot = 45,
column_names_gp = column_names_gp,
rect_gp = rect_gp,
na_col = "white",
cluster_rows = TRUE,
rect_gp = rect_gp,
row_names_gp = row_names_gp,
row_dend_width = unit(5, "cm"),
row_split = NULL,
column_split = 2,
row_gap = unit(2, "mm"),
cluster_columns = TRUE,
column_gap = unit(2, "mm"),
show_column_dend = F,
show_row_dend = F,
row_dend_side = "left",
column_dend_side = "top",
clustering_distance_rows = "euclidean",
border = F,
width = width,
height = height)
# Values colors
col_fun <- colorRamp2(c(-2, 0, 2), c("#9bc1bc", "black", "#ed6a5a"))
file = filename
mat = matrix_data
width = unit(2, "cm")
height = unit(45, "cm")
width_image = 10
height_image = 50
column_names_gp = gpar(fontsize = 10)
row_names_gp = gpar(fontsize = 0)
rect_gp = gpar(col = "black", lwd = 0)
fileimageheatmap_grouped = paste0(file, sep ="_", "Complexheatmap.png")
png(file = fileimageheatmap_grouped,
width = width_image,
height = height_image,
units="cm",
res=900)
heatmap_plot = Heatmap(mat,
top_annotation = ha,
#left_annotation = row_ha,
show_row_names = TRUE,
row_names_side = "right",
show_heatmap_legend = TRUE,
heatmap_legend_param = list(direction = "vertical"),
col = col_fun, #color
show_column_names = TRUE,
column_title = fileimageheatmap_grouped,
column_title_gp = gpar(fontsize = 10, fontface = "bold"),
column_names_rot = 45,
column_names_gp = column_names_gp,
rect_gp = rect_gp,
na_col = "white",
cluster_rows = TRUE,
row_names_gp = row_names_gp,
row_dend_width = unit(5, "cm"),
row_split = NULL,
column_split = 2,
row_gap = unit(2, "mm"),
cluster_columns = TRUE,
column_gap = unit(2, "mm"),
show_column_dend = F,
show_row_dend = F,
row_dend_side = "left",
column_dend_side = "top",
clustering_distance_rows = "euclidean",
border = F,
width = width,
height = height)
heatmap_plot = draw(heatmap_plot,
annotation_legend_side = "left",
heatmap_legend_side = "left")
dev.off()
file = filename
mat = matrix_data
width = unit(2, "cm")
height = unit(45, "cm")
width_image = 10
height_image = 50
column_names_gp = gpar(fontsize = 10)
row_names_gp = gpar(fontsize = 0)
rect_gp = gpar(col = "black", lwd = 0)
fileimageheatmap_grouped = paste0(file, sep ="_", "Complexheatmap.png")
png(file = fileimageheatmap_grouped,
width = width_image,
height = height_image,
units="cm",
res=900)
heatmap_plot = Heatmap(mat,
top_annotation = ha,
#left_annotation = row_ha,
show_row_names = TRUE,
row_names_side = "right",
show_heatmap_legend = TRUE,
heatmap_legend_param = list(direction = "vertical"),
col = col_fun, #color
show_column_names = TRUE,
column_title = fileimageheatmap_grouped,
column_title_gp = gpar(fontsize = 10, fontface = "bold"),
column_names_rot = 45,
column_names_gp = column_names_gp,
rect_gp = rect_gp,
na_col = "white",
cluster_rows = TRUE,
row_names_gp = row_names_gp,
row_dend_width = unit(5, "cm"),
row_split = NULL,
column_split = 2,
row_gap = unit(2, "mm"),
cluster_columns = TRUE,
column_gap = unit(2, "mm"),
show_column_dend = F,
show_row_dend = F,
row_dend_side = "left",
column_dend_side = "top",
clustering_distance_rows = "euclidean",
border = F,
width = width,
height = height)
heatmap_plot = draw(heatmap_plot,
annotation_legend_side = "left",
heatmap_legend_side = "left")
dev.off()
png(file = fileimageheatmap_grouped,
width = width_image,
height = height_image,
units="cm",
res=900)
heatmap_plot = Heatmap(mat,
top_annotation = ha,
#left_annotation = row_ha,
show_row_names = TRUE,
row_names_side = "right",
show_heatmap_legend = TRUE,
heatmap_legend_param = list(direction = "vertical"),
col = col_fun, #color
name = "Log2-fold change",
show_column_names = TRUE,
column_title = fileimageheatmap_grouped,
column_title_gp = gpar(fontsize = 10, fontface = "bold"),
column_names_rot = 45,
column_names_gp = column_names_gp,
rect_gp = rect_gp,
na_col = "white",
cluster_rows = TRUE,
row_names_gp = row_names_gp,
row_dend_width = unit(5, "cm"),
row_dend_gp = gpar(col = "black"),
row_split = NULL,
column_split = 2,
row_gap = unit(2, "mm"),
cluster_columns = TRUE,
column_gap = unit(2, "mm"),
show_column_dend = F,
show_row_dend = F,
row_dend_side = "left",
column_dend_side = "top",
clustering_distance_rows = "euclidean",
border = F,
width = width,
height = height)
heatmap_plot = draw(heatmap_plot,
annotation_legend_side = "left",
heatmap_legend_side = "left")
dev.off()
png(file = fileimageheatmap_grouped,
width = width_image,
height = height_image,
units="cm",
res=900)
heatmap_plot = Heatmap(mat,
top_annotation = ha,
#left_annotation = row_ha,
show_row_names = TRUE,
row_names_side = "right",
show_heatmap_legend = TRUE,
heatmap_legend_param = list(direction = "vertical"),
col = col_fun, #color
name = "Log2-fold change",
show_column_names = TRUE,
column_title = fileimageheatmap_grouped,
column_title_gp = gpar(fontsize = 10, fontface = "bold"),
column_names_rot = 45,
column_names_gp = column_names_gp,
rect_gp = rect_gp,
na_col = "white",
cluster_rows = TRUE,
row_names_gp = row_names_gp,
row_dend_width = unit(10, "cm"),
row_split = NULL,
column_split = 2,
row_gap = unit(2, "mm"),
cluster_columns = TRUE,
column_gap = unit(2, "mm"),
show_column_dend = F,
show_row_dend = T,
row_dend_side = "left",
column_dend_side = "top",
clustering_distance_rows = "euclidean",
border = F,
width = width,
height = height)
heatmap_plot = draw(heatmap_plot,
annotation_legend_side = "left",
heatmap_legend_side = "left")
dev.off()
file = filename
mat = matrix_data
width = unit(2, "cm")
height = unit(45, "cm")
width_image = 10
height_image = 50
column_names_gp = gpar(fontsize = 10)
row_names_gp = gpar(fontsize = 0)
rect_gp = gpar(col = "black", lwd = 0)
fileimageheatmap_grouped = paste0(file, sep ="_", "Complexheatmap.png")
png(file = fileimageheatmap_grouped,
width = width_image,
height = height_image,
units="cm",
res=900)
heatmap_plot = Heatmap(mat,
top_annotation = ha,
#left_annotation = row_ha,
show_row_names = TRUE,
row_names_side = "right",
show_heatmap_legend = TRUE,
heatmap_legend_param = list(direction = "vertical"),
col = col_fun, #color
name = "Log2-fold change",
show_column_names = TRUE,
column_title = fileimageheatmap_grouped,
column_title_gp = gpar(fontsize = 10, fontface = "bold"),
column_names_rot = 45,
column_names_gp = column_names_gp,
rect_gp = rect_gp,
na_col = "white",
cluster_rows = TRUE,
row_names_gp = row_names_gp,
row_dend_width = unit(3, "cm"),
row_split = NULL,
column_split = 2,
row_gap = unit(2, "mm"),
cluster_columns = TRUE,
column_gap = unit(2, "mm"),
show_column_dend = F,
show_row_dend = T,
row_dend_side = "left",
column_dend_side = "top",
clustering_distance_rows = "euclidean",
border = F,
width = width,
height = height)
heatmap_plot = draw(heatmap_plot,
annotation_legend_side = "left",
heatmap_legend_side = "left")
dev.off()
png(file = fileimageheatmap_grouped,
width = width_image,
height = height_image,
units="cm",
res=900)
heatmap_plot = Heatmap(mat,
top_annotation = ha,
#left_annotation = row_ha,
show_row_names = TRUE,
row_names_side = "right",
show_heatmap_legend = TRUE,
heatmap_legend_param = list(direction = "vertical"),
col = col_fun, #color
name = "Log2-fold change",
show_column_names = TRUE,
column_title = fileimageheatmap_grouped,
column_title_gp = gpar(fontsize = 10, fontface = "bold"),
column_names_rot = 45,
column_names_gp = column_names_gp,
rect_gp = rect_gp,
na_col = "white",
cluster_rows = TRUE,
row_names_gp = row_names_gp,
row_dend_width = unit(3, "cm"),
row_split = NULL,
column_split = 2,
row_gap = unit(2, "mm"),
cluster_columns = TRUE,
column_gap = unit(2, "mm"),
show_column_dend = F,
show_row_dend = F,
row_dend_side = "left",
column_dend_side = "top",
clustering_distance_rows = "euclidean",
border = F,
width = width,
height = height)
heatmap_plot = draw(heatmap_plot,
annotation_legend_side = "left",
heatmap_legend_side = "left")
dev.off()
setwd("~/Desktop/Yohan")
library(tidyverse)
library(ComplexHeatmap)
library(janitor)
library(RColorBrewer)
library(circlize)
library(readxl)
library(readxl)
counts_G1 <- read_excel("counts_G1.xlsx")
View(counts_G1)
# Preprocess ------------------------------------------------------------------------vi
countsmatrix <- read_excel("countsmatrix.xlsx")
setwd("~/Desktop/Yohan")
# Preprocess ------------------------------------------------------------------------vi
countsmatrix <- read_excel("countsmatrix.xlsx")
# Preprocess ------------------------------------------------------------------------vi
countsmatrix <- read_rds("countsmatrix.rds")
annotation <- read_excel("HM.xlsx")
#Annotations table (columns)
conditions_annotations <- annotation
glimpse(countsmatrix)
#Colors
colors_cols = list(
Condition =c("1" = "#d9ed92",
"2" = "purple",
"3" = "royalblue")
)
#Inputs
genes_heatmap = countsmatrix
cond_ann = conditions_annotations %>%
filter(Condition!="GX") %>%
drop_na(Condition)
filename = "Counts_Grade_1_2_3"
#Matrix ------
genes_matrix = genes_heatmap %>%
rename(genes = sample) %>%
column_to_rownames("genes") %>%
as.matrix() %>%
replace(is.na(.), 0)
#Annotations ------
#Columns
ann_cols_heatmap = genes_matrix %>%
colnames() %>%
data.frame() %>%
filter(. != "genes") %>%
rename(sample = '.') %>%
inner_join(cond_ann, by = "sample") %>%
distinct() %>%
arrange(sample) %>%
column_to_rownames("sample")
#Reorder and match cols
matrix_data = genes_matrix %>%
t() %>%
as.data.frame() %>%
rownames_to_column(var= "sample") %>%
inner_join(ann_cols_heatmap %>% rownames_to_column("sample"), by = "sample") %>%
select(!c(Condition)) %>%
arrange(sample) %>%
column_to_rownames("sample") %>%
t() %>%
as.data.frame() %>%
mutate_if(is.character, as.numeric) %>%
as.matrix()
#Annotations ------
#Columns
ann_cols_heatmap = genes_matrix %>%
colnames() %>%
data.frame() %>%
filter(. != "genes") %>%
rename(sample = '.') %>%
inner_join(cond_ann, by = "sample") %>%
distinct() %>%
arrange(sample) %>%
column_to_rownames("sample")
#Reorder and match cols
matrix_data = genes_matrix %>%
t() %>%
as.data.frame() %>%
rownames_to_column(var= "sample") %>%
inner_join(ann_cols_heatmap %>% rownames_to_column("sample"), by = "sample") %>%
select(!c(Condition)) %>%
arrange(sample) %>%
column_to_rownames("sample") %>%
t() %>%
as.data.frame() %>%
mutate_if(is.character, as.numeric) %>%
as.matrix()
matrix_data
#Dimensions (checking)
dim(matrix_data)
#Heatmap annotation
ha = HeatmapAnnotation(df = ann_cols_heatmap,
col = colors_cols,
annotation_name_side = "right")
ann_cols_heatmap
dim(ann_cols_heatmap)
source("~/Desktop/Yohan/HeatmapCounts_1_2_3.R", echo=TRUE)
#Dimensions (checking)
dim(matrix_data)
dim(ann_cols_heatmap)
#Heatmap annotation
ha = HeatmapAnnotation(df = ann_cols_heatmap,
col = colors_cols,
annotation_name_side = "right")
# Values colors
col_fun <- colorRamp2(c( 0, 10), c( "black", "#ed6a5a"))
#Parameters for heatmap
file = filename
mat = matrix_data
width = unit(10, "in")
height = unit(6, "in")
width_image = 10
height_image = 6
column_names_gp = gpar(fontsize = 10)
row_names_gp = gpar(fontsize = 0)
rect_gp = gpar(col = "black", lwd = 0)
fileimageheatmap_grouped = paste0(file, sep ="_", "Complexheatmap.png")
fileimageheatmap_grouped
png(file = fileimageheatmap_grouped,
width = width_image,
height = height_image,
units="in",
res=300)
heatmap_plot = Heatmap(mat,
use_raster = TRUE,
raster_quality = 1,
raster_resize_mat = TRUE,
top_annotation = ha,
show_row_names = TRUE,
row_names_side = "right",
show_heatmap_legend = TRUE,
heatmap_legend_param = list(direction = "vertical"),
col = col_fun, #color
name = "Log2-fold change",
show_column_names = TRUE,
column_title = fileimageheatmap_grouped,
column_title_gp = gpar(fontsize = 10, fontface = "bold"),
column_names_rot = 45,
column_names_gp = column_names_gp,
rect_gp = rect_gp,
na_col = "white",
cluster_rows = TRUE,
row_names_gp = row_names_gp,
row_dend_width = unit(3, "cm"),
row_split = NULL,
column_split = 2,
row_gap = unit(2, "mm"),
cluster_columns = TRUE,
column_gap = unit(2, "mm"),
show_column_dend = F,
show_row_dend = F,
row_dend_side = "left",
column_dend_side = "top",
clustering_distance_rows = "euclidean",
border = F,
width = width,
height = height)
heatmap_plot = draw(heatmap_plot,
annotation_legend_side = "left",
heatmap_legend_side = "left")
png(file = fileimageheatmap_grouped,
width = width_image,
height = height_image,
units="in",
res=300)
heatmap_plot = Heatmap(mat,
use_raster = TRUE,
# raster_quality = 1,
raster_resize_mat = TRUE,
top_annotation = ha,
show_row_names = F,
row_names_side = "right",
show_heatmap_legend = TRUE,
heatmap_legend_param = list(direction = "vertical"),
col = col_fun, #color
name = "Log2-fold change",
show_column_names = TRUE,
column_title = fileimageheatmap_grouped,
column_title_gp = gpar(fontsize = 10, fontface = "bold"),
column_names_rot = 45,
column_names_gp = column_names_gp,
rect_gp = rect_gp,
na_col = "white",
cluster_rows = TRUE,
row_names_gp = row_names_gp,
row_dend_width = unit(3, "cm"),
row_split = NULL,
column_split = 2,
row_gap = unit(2, "mm"),
cluster_columns = TRUE,
column_gap = unit(2, "mm"),
show_column_dend = F,
show_row_dend = F,
row_dend_side = "left",
column_dend_side = "top",
clustering_distance_rows = "euclidean",
border = F,
width = width,
height = height)
heatmap_plot = draw(heatmap_plot,
annotation_legend_side = "left",
heatmap_legend_side = "left")
install.packages("grDevices")
install.packages("grDevices")
install.packages("cairo")
install.packages("Cairo")
library(Cairo)
install.packages("Cairo", repo="https://RForge.net")
write.csv(countsmatrix, file = "countsmatrix.csv", row.names = F)
